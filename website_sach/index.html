<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Website Gi·ªõi Thi·ªáu S√°ch</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background:linear-gradient(180deg,#f1f5f9,#e2e8f0);
}

/* ===== SIDEBAR ===== */
.sidebar{
    background:linear-gradient(180deg,#0f172a,#1e293b);
    color:#fff;
    min-height:100vh;
    padding:18px
}
.sidebar h5{cursor:pointer}
.sidebar ul{list-style:none;padding-left:0;margin-top:10px}
.sidebar li{
    padding:8px 10px;
    cursor:pointer;
    border-radius:8px;
    margin-bottom:4px
}
.sidebar li:hover,.sidebar li.active{
    background:#334155
}

/* ===== TOP MENU ===== */
.top-menu button{
    border-radius:999px;
    padding:6px 18px
}

/* ===== HERO ===== */
.hero {
    background: linear-gradient(90deg, #2563eb, #7c3aed);
    color: #fff;
    /* Thay ƒë·ªïi padding t·ª´ 50px-60px xu·ªëng c√≤n kho·∫£ng 20px-30px */
    padding: 30px 20px; 
    border-radius: 20px;
    margin-bottom: 25px; /* Kho·∫£ng c√°ch v·ªõi ph·∫ßn ch·ªØ Kh√°m ph√° s√°ch hay */
    text-align: center;
}

.hero h2 {
    font-size: 1.8rem; /* Cho ch·ªØ ti√™u ƒë·ªÅ nh·ªè l·∫°i m·ªôt ch√∫t n·∫øu c·∫ßn */
    font-weight: 800;
}

.hero p {
    font-size: 1rem;
    opacity: 0.9;
    margin-bottom: 15px;
}

/* ===== SHARE BOX ===== */
.share-box {
    background: linear-gradient(135deg, #f8fafc, #e0f2fe);
    border-left: 6px solid #0d6efd;
    border-radius: 18px;
    padding: 15px 25px; /* Gi·∫£m padding t·ª´ 28px xu·ªëng 15px */
    margin-bottom: 25px; /* Gi·∫£m kho·∫£ng c√°ch d∆∞·ªõi t·ª´ 50px xu·ªëng 25px */
}

.share-box h3 {
    font-size: 1.4rem; /* Thu nh·ªè c·ª° ch·ªØ ti√™u ƒë·ªÅ */
    margin-bottom: 5px !important;
}

.share-box p {
    font-size: 0.9rem; /* Thu nh·ªè c·ª° ch·ªØ m√¥ t·∫£ */
    margin-bottom: 15px !important;
}

.share-box .form-control {
    padding: 6px 12px; /* Thu nh·ªè c√°c √¥ input */
    font-size: 0.9rem;
}

.share-box .btn-lg {
    padding: 8px 20px; /* Thu nh·ªè n√∫t g·ª≠i */
    font-size: 1rem;
    margin-top: 15px !important;
}

/* ===== BOOK CARD IMPROVED ===== */
.book-card {
    background: #ffffff;
    border-radius: 20px; /* Bo g√≥c m·ªÅm m·∫°i h∆°n */
    padding: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    border: 1px solid #f1f5f9;
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.book-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}

.book-card img {
    width: 100%;
    height: 220px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh cho ·∫£nh */
    object-fit: cover;
    border-radius: 15px;
    margin-bottom: 15px;
}

.book-title {
    font-size: 1.05rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 5px;
    /* Gi·ªõi h·∫°n t√™n s√°ch trong 2 d√≤ng ƒë·ªÉ card kh√¥ng b·ªã l·ªách */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    height: 2.8rem; 
}

.author-name {
    color: #64748b;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.category-badge {
    background: #f0f7ff;
    color: #0284c7;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 99px;
    display: inline-block;
    margin-bottom: 15px;
}

.btn-detail {
    background: #fff;
    color: #2563eb;
    border: 1.5px solid #2563eb;
    border-radius: 12px;
    padding: 8px;
    font-weight: 600;
    transition: all 0.2s;
    width: 100%;
    margin-top: auto; /* ƒê·∫©y n√∫t xu·ªëng d∆∞·ªõi c√πng c·ªßa card */
}

.btn-detail:hover {
    background: #2563eb;
    color: #fff;
}

/* ===== TOP MENU BUTTONS (N·ªîI B·∫¨T H∆†N) ===== */
.top-menu button{
    border-radius:999px;
    padding:8px 22px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:6px;
    box-shadow:0 6px 18px rgba(0,0,0,.15);
    transition:all .25s ease;
}

.top-menu button:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 26px rgba(0,0,0,.25);
}

/* m√†u ri√™ng cho t·ª´ng n√∫t */
.btn-home{
    background:linear-gradient(135deg,#2563eb,#3b82f6);
    color:#fff;
    border:none;
}
.btn-search{
    background:linear-gradient(135deg,#16a34a,#22c55e);
    color:#fff;
    border:none;
}
.btn-admin{
    background:linear-gradient(135deg,#f59e0b,#fbbf24);
    color:#1f2937;
    border:none;
}

</style>
</head>

<body>

<div class="container-fluid">
<div class="row">

<!-- ===== SIDEBAR ===== -->
<div class="col-md-2 sidebar">
    <h5 onclick="toggleCategory()">
        üìö Th·ªÉ lo·∫°i <span id="arrow">‚ñº</span>
    </h5>
    <ul id="categoryList"></ul>
</div>

<!-- ===== CONTENT ===== -->
<div class="col-md-10 p-4">

<!-- ===== TOP MENU ===== -->
<div class="d-flex justify-content-end mb-4 gap-3 top-menu">
    <button class="btn-home" onclick="showHome()">
        üè† Trang ch·ªß
    </button>

    <button class="btn-search" onclick="showSearch()">
        üîç T√¨m ki·∫øm
    </button>

    <button class="btn-admin" onclick="goAdmin()">
        ‚öô Admin
    </button>
</div>

<!-- ================= HOME ================= -->
<div id="homePage">

<!-- HERO -->
<div class="hero text-center">
    <h1 class="fw-bold mb-3">üéì Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Website Gi·ªõi Thi·ªáu S√°ch</h1>
    <p class="lead mb-0">
        N∆°i b·∫°n c√≥ th·ªÉ kh√°m ph√° nh·ªØng cu·ªën s√°ch hay, th√∫ v·ªã v√† b·ªï √≠ch<br>
        Chia s·∫ª tri th·ª©c ‚Äì Lan t·ªèa ƒëam m√™ ƒë·ªçc s√°ch
    </p>
</div>

<!-- SHARE BOOK -->
<div class="share-box shadow">
    <h3 class="fw-bold mb-2">üì§ Chia s·∫ª s√°ch c·ªßa b·∫°n</h3>
    <p class="text-muted mb-4">
        C√≥ s√°ch hay? G·ª≠i cho ch√∫ng m√¨nh ƒë·ªÉ admin duy·ªát v√† chia s·∫ª ƒë·∫øn c·ªông ƒë·ªìng üöÄ
    </p>

    <div class="row">
        <div class="col-md-4 mb-2">
            <input id="uTitle" class="form-control" placeholder="üìò T√™n s√°ch">
        </div>
        <div class="col-md-4 mb-2">
            <input id="uAuthor" class="form-control" placeholder="‚úçÔ∏è T√°c gi·∫£">
        </div>
        <div class="col-md-4 mb-2">
            <input id="uCategory" class="form-control" placeholder="üè∑Ô∏è Th·ªÉ lo·∫°i">
        </div>
    </div>

    <input type="file"
           class="form-control mt-2"
           accept="image/*"
           onchange="handleUserImage(event)">

    <img id="userPreview"
         class="mt-3"
         style="max-height:160px;display:none;border-radius:12px">

    <button class="btn btn-primary btn-lg mt-4" onclick="submitBook()">
        üöÄ G·ª≠i s√°ch ch·ªù duy·ªát
    </button>

    <small class="text-muted d-block mt-3">
        ‚è≥ S√°ch s·∫Ω hi·ªÉn th·ªã sau khi admin duy·ªát
    </small>
</div>

<h4 class="mb-3 fw-bold">‚ú® Kh√°m ph√° s√°ch hay</h4>
<div class="row" id="bookList"></div>

</div>

<!-- ================= SEARCH ================= -->
<div id="searchPage" style="display:none;">
    <h3 class="fw-bold mb-3">üîç T√¨m ki·∫øm s√°ch</h3>
    <input id="searchInput" class="form-control mb-3"
           placeholder="Nh·∫≠p t√™n s√°ch ho·∫∑c t√°c gi·∫£...">
    <div class="row" id="searchResult"></div>
</div>

</div>
</div>
</div>

<!-- ================= JS ================= -->
<script src="js/data.js"></script>

<script>
/* ===== STATE ===== */
let currentCategory = "all";
let searchKeyword = "";
let currentPage = "home";

/* ===== DOM ===== */
const bookList = document.getElementById("bookList");
const searchResult = document.getElementById("searchResult");
const homePage = document.getElementById("homePage");
const searchPage = document.getElementById("searchPage");
const searchInput = document.getElementById("searchInput");
const categoryList = document.getElementById("categoryList");
const arrow = document.getElementById("arrow");

/* ===== DATA ===== */
function getBooks(){
    return JSON.parse(localStorage.getItem("books")) || [];
}
function getCategories(){
    return JSON.parse(localStorage.getItem("categories")) || [];
}

/* ===== FILTER ===== */
function getFilteredBooks(){
    let books = getBooks();

    if(currentCategory !== "all"){
        books = books.filter(b => b.category === currentCategory);
    }

    if(searchKeyword){
        books = books.filter(b =>
            b.title.toLowerCase().includes(searchKeyword) ||
            b.author.toLowerCase().includes(searchKeyword)
        );
    }
    return books;
}

/* ===== RENDER (ƒê√É TH√äM N√öT XEM CHI TI·∫æT) ===== */
function renderBooks(list, target) {
    target.innerHTML = "";

    if (list.length === 0) {
        target.innerHTML = `
            <div class="col-12 text-center py-5">
                <p class="text-muted">Kh√¥ng t√¨m th·∫•y s√°ch n√†o ph√π h·ª£p.</p>
            </div>`;
        return;
    }

    list.forEach((book, i) => {
        // L·∫•y l·∫°i danh s√°ch ƒë√£ l·ªçc ƒë·ªÉ ƒë·∫£m b·∫£o index ch√≠nh x√°c khi click
        target.innerHTML += `
        <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
            <div class="book-card shadow-sm">
                <img src="${book.image || 'images/book1.jpg'}" 
                     onerror="this.src='https://via.placeholder.com/200x300?text=No+Cover'">
                
                <div class="book-title" title="${book.title}">${book.title}</div>
                <div class="author-name">‚úçÔ∏è ${book.author}</div>
                
                <div>
                    <span class="category-badge">${book.category}</span>
                </div>

                <button class="btn-detail" onclick="viewDetail(${i})">
                    üìñ Xem chi ti·∫øt
                </button>
            </div>
        </div>`;
    });
}

function renderCurrent(){
    const target =
        currentPage === "home" ? bookList : searchResult;
    renderBooks(getFilteredBooks(), target);
}

function renderCategoriesHome(){
    categoryList.innerHTML =
        `<li class="active" onclick="filterCategory('all',this)">T·∫•t c·∫£</li>`;

    getCategories().forEach(cat=>{
        categoryList.innerHTML +=
            `<li onclick="filterCategory('${cat}',this)">${cat}</li>`;
    });
}

/* ===== NAV ===== */
function showHome(){
    currentPage = "home";
    homePage.style.display = "block";
    searchPage.style.display = "none";
    renderCurrent();
}
function showSearch(){
    currentPage = "search";
    homePage.style.display = "none";
    searchPage.style.display = "block";
    renderCurrent();
}
function goAdmin(){
    location.href =
        localStorage.getItem("isAdmin")==="true"
        ? "admin.html"
        : "login.html";
}

/* ===== SEARCH ===== */
searchInput.addEventListener("input",()=>{
    searchKeyword = searchInput.value.toLowerCase();
    renderCurrent();
});

/* ===== CATEGORY ===== */
function filterCategory(cat,el){
    currentCategory = cat;
    document.querySelectorAll(".sidebar li")
        .forEach(li=>li.classList.remove("active"));
    el.classList.add("active");
    renderCurrent();
}

function toggleCategory(){
    categoryList.style.display =
        categoryList.style.display==="none"?"block":"none";
    arrow.innerHTML =
        categoryList.style.display==="none"?"‚ñ≤":"‚ñº";
}

/* ===== DETAIL (C·∫¨P NH·∫¨T ƒê·ªÇ TRUY·ªÄN D·ªÆ LI·ªÜU) ===== */
function viewDetail(i){
    // L·∫•y danh s√°ch s√°ch ƒëang hi·ªÉn th·ªã hi·ªán t·∫°i (ƒë√£ l·ªçc/t√¨m ki·∫øm)
    const currentList = getFilteredBooks();
    const selectedBook = currentList[i];

    // L∆∞u to√†n b·ªô ƒë·ªëi t∆∞·ª£ng s√°ch v√†o LocalStorage
    localStorage.setItem("selectedBookDetail", JSON.stringify(selectedBook));
    
    // Chuy·ªÉn h∆∞·ªõng sang trang chi ti·∫øt
    location.href = "detail.html";
}

/* ===== INIT (C·ª∞C K·ª≤ QUAN TR·ªåNG) ===== */
window.addEventListener("load", () => {
    renderCategoriesHome();
    renderCurrent();
});

/* ===== X·ª¨ L√ù G·ª¨I S√ÅCH (B·∫†N ƒêANG THI·∫æU PH·∫¶N N√ÄY) ===== */
let userImgBase64 = ""; // Bi·∫øn l∆∞u ·∫£nh t·∫°m th·ªùi

// H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng ch·ªçn file ·∫£nh
function handleUserImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            userImgBase64 = e.target.result; // Chuy·ªÉn ·∫£nh sang d·∫°ng chu·ªói Base64
            const preview = document.getElementById("userPreview");
            preview.src = userImgBase64;
            preview.style.display = "block";
        };
        reader.readAsDataURL(file);
    }
}

// H√†m g·ª≠i s√°ch v√†o h√†ng ƒë·ª£i ch·ªù duy·ªát (pendingBooks)
function submitBook() {
    const title = document.getElementById("uTitle").value.trim();
    const author = document.getElementById("uAuthor").value.trim();
    const category = document.getElementById("uCategory").value.trim();

    if (!title || !author || !category) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin s√°ch!");
        return;
    }

    // L·∫•y danh s√°ch ch·ªù duy·ªát hi·ªán c√≥ ho·∫∑c t·∫°o m·ªõi
    let pending = JSON.parse(localStorage.getItem("pendingBooks")) || [];

    // T·∫°o ƒë·ªëi t∆∞·ª£ng s√°ch m·ªõi
    const newPendingBook = {
        title: title,
        author: author,
        category: category,
        image: userImgBase64 || "images/book1.jpg", 
        status: "pending",
        // L∆ØU D·∫†NG S·ªê ƒê·ªÇ M√ÅY T√çNH LU√îN ƒê·ªåC ƒê√öNG
        date: new Date().getTime() 
    };

    // Th√™m v√†o m·∫£ng v√† l∆∞u l·∫°i LocalStorage
    pending.push(newPendingBook);
    localStorage.setItem("pendingBooks", JSON.stringify(pending));

    // Th√¥ng b√°o v√† reset form
    alert("‚úÖ G·ª≠i s√°ch th√†nh c√¥ng! Vui l√≤ng ch·ªù Admin duy·ªát.");
    
    // Reset giao di·ªán
    document.getElementById("uTitle").value = "";
    document.getElementById("uAuthor").value = "";
    document.getElementById("uCategory").value = "";
    document.getElementById("userPreview").style.display = "none";
    userImgBase64 = "";
}
</script>

</body>
</html>
