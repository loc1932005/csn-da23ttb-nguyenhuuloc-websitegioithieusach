<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Qu·∫£n l√Ω s√°ch</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f4f6f9}
.card{border:none;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
.badge-category{
    background:linear-gradient(135deg,#dbeafe,#eff6ff);
    color:#1e40af;border:1px solid #bfdbfe;
    border-radius:999px;padding:6px 14px;font-weight:500;
    display:inline-flex;align-items:center;gap:6px
}
.badge-category span{cursor:pointer;color:#ef4444;font-weight:bold}
.toggle-btn{background:#e5e7eb;border:none;padding:6px 12px;border-radius:8px}
.table-bordered{border:2px solid #000}
.table-bordered th,.table-bordered td{border:1px solid #000}
.table thead{background:#1f2937;color:#fff}
.toggle-box{overflow:hidden;transition:max-height .3s ease,opacity .3s ease}
.toggle-box.hidden{max-height:0;opacity:0}
.toggle-box.visible{max-height:1000px;opacity:1}
</style>
</head>

<body>

<!-- ===== KI·ªÇM TRA QUY·ªÄN ADMIN ===== -->
<script>
if(localStorage.getItem("isAdmin") !== "true"){
    location.href = "login.html";
}
</script>

<div class="container py-4">

<!-- ================= HEADER ================= -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">üìò Trang qu·∫£n tr·ªã s√°ch</h3>

    <div class="d-flex align-items-center gap-2">

        <!-- üîî S√ÅCH CH·ªú DUY·ªÜT -->
        <a href="admin-review.html"
           class="btn btn-outline-danger position-relative">
            üîî Ch·ªù duy·ªát
            <span id="pendingBadge"
                  class="position-absolute top-0 start-100 translate-middle
                         badge rounded-pill bg-danger"
                  style="display:none">0</span>
        </a>

        <button class="btn btn-success btn-sm" onclick="exportExcel()">üßæ Excel</button>
        <button class="btn btn-info btn-sm" onclick="exportData()">üì§ Export JSON</button>
        <a href="index.html" class="btn btn-primary btn-sm">‚¨Ö Trang ch·ªß</a>
        <button class="btn btn-danger btn-sm" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
    </div>
</div>

<!-- ================= TH·ªêNG K√ä ================= -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">T·ªïng s·ªë s√°ch</h6>
                <h2 id="totalBooks" class="fw-bold text-primary">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Th·ªÉ lo·∫°i (theo s√°ch)</h6>
                <h2 id="totalCategories" class="fw-bold text-success">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Th·ªÉ lo·∫°i h·ªá th·ªëng</h6>
                <h2 id="totalSystemCategories" class="fw-bold text-danger">0</h2>
            </div>
        </div>
    </div>
</div>

<!-- ================= SEARCH + FILTER ================= -->
<div class="row mb-3">
    <div class="col-md-6">
        <input id="searchInput"
               class="form-control"
               placeholder="üîç T√¨m theo t√™n s√°ch ho·∫∑c t√°c gi·∫£"
               oninput="renderTable()">
    </div>
    <div class="col-md-3">
        <select id="filterCategory"
                class="form-select"
                onchange="renderTable()">
            <option value="">-- T·∫•t c·∫£ th·ªÉ lo·∫°i --</option>
        </select>
    </div>
</div>

<!-- ================= TH·ªÇ LO·∫†I ================= -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <h6 class="fw-bold">üìö Th·ªÉ lo·∫°i (theo s√°ch)</h6>
                    <button class="toggle-btn" onclick="toggleBox('byBooks')">·∫®n / Hi·ªán</button>
                </div>
                <div id="byBooks" class="toggle-box hidden"></div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <h6 class="fw-bold">üóÇÔ∏è Th·ªÉ lo·∫°i (h·ªá th·ªëng)</h6>
                    <button class="toggle-btn" onclick="toggleBox('systemCats')">·∫®n / Hi·ªán</button>
                </div>
                <div id="systemCats" class="toggle-box hidden"></div>
            </div>
        </div>
    </div>
</div>

<!-- ================= TH√äM TH·ªÇ LO·∫†I ================= -->
<div class="card mb-4">
    <div class="card-body">
        <h6 class="fw-bold">‚ûï Th√™m th·ªÉ lo·∫°i</h6>
        <div class="d-flex mb-3">
            <input id="newCategory" class="form-control me-2" placeholder="T√™n th·ªÉ lo·∫°i">
            <button class="btn btn-primary" onclick="addCategory()">Th√™m</button>
        </div>
        <div id="categoryAdminSystem"></div>
    </div>
</div>

<!-- ================= FORM S√ÅCH ================= -->
<div class="card mb-4">
    <div class="card-body">
        <h5>‚ûï Th√™m / S·ª≠a s√°ch</h5>

        <input type="hidden" id="editIndex">

        <input id="title" class="form-control mb-2" placeholder="T√™n s√°ch">
        <input id="author" class="form-control mb-2" placeholder="T√°c gi·∫£">
        <select id="category" class="form-select mb-2"></select>

        <input id="imageURL"
               class="form-control mb-2"
               placeholder="VD: images/book12.jpg"
               oninput="previewImage()">

        <img id="preview" style="max-height:150px;display:none;border-radius:10px">

        <button class="btn btn-primary" onclick="saveBook()">L∆∞u</button>
        <button class="btn btn-secondary" onclick="resetForm()">H·ªßy</button>
    </div>
</div>

<!-- ================= B·∫¢NG S√ÅCH ================= -->
<div class="card">
    <div class="card-body p-0">
        <table class="table table-bordered text-center mb-0">
            <thead>
                <tr>
                    <th>#</th>
                    <th>·∫¢nh</th>
                    <th>T√™n</th>
                    <th>T√°c gi·∫£</th>
                    <th>Th·ªÉ lo·∫°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="bookTable"></tbody>
        </table>
    </div>
</div>

</div>

<!-- XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- ADMIN JS -->
<script src="js/admin.js"></script>

</body>
</html>
